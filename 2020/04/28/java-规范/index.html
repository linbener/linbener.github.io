<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>java 规范 | LIN is keeping learning</title><meta name="description" content="java 规范"><meta name="keywords" content="java"><meta name="author" content="Lin"><meta name="copyright" content="Lin"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="java 规范"><meta name="twitter:description" content="java 规范"><meta name="twitter:image" content="http://yoursite.com/img/cat.jpg"><meta property="og:type" content="article"><meta property="og:title" content="java 规范"><meta property="og:url" content="http://yoursite.com/2020/04/28/java-%E8%A7%84%E8%8C%83/"><meta property="og:site_name" content="LIN is keeping learning"><meta property="og:description" content="java 规范"><meta property="og:image" content="http://yoursite.com/img/cat.jpg"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://yoursite.com/2020/04/28/java-%E8%A7%84%E8%8C%83/"><link rel="prev" title="java 学习笔记二" href="http://yoursite.com/2020/04/28/java-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%BA%8C/"><link rel="next" title="算法 java,go实现" href="http://yoursite.com/2020/04/25/%E7%AE%97%E6%B3%95-java%E5%AE%9E%E7%8E%B0/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://linbener.github.io","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: true,
  copyright: undefined,
  ClickShowText: {"text":"爱国,敬业,友善,诚实,自由,平等,和谐","fontSize":"12px"},
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'true',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/tou.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">29</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">14</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">1</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#编程规约"><span class="toc-number">1.</span> <span class="toc-text">编程规约</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#OOP规范"><span class="toc-number">1.0.1.</span> <span class="toc-text">OOP规范</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#日期时间"><span class="toc-number">1.0.2.</span> <span class="toc-text">日期时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#集合处理"><span class="toc-number">1.0.3.</span> <span class="toc-text">集合处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#并发"><span class="toc-number">1.0.4.</span> <span class="toc-text">并发</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#异常日志"><span class="toc-number">2.</span> <span class="toc-text">异常日志</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#异常处理"><span class="toc-number">2.0.1.</span> <span class="toc-text">异常处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#日志规约"><span class="toc-number">2.0.2.</span> <span class="toc-text">日志规约</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#单元测试"><span class="toc-number">3.</span> <span class="toc-text">单元测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安全规约"><span class="toc-number">4.</span> <span class="toc-text">安全规约</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MYSQL规约"><span class="toc-number">5.</span> <span class="toc-text">MYSQL规约</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#建表规约"><span class="toc-number">5.0.1.</span> <span class="toc-text">建表规约</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#索引规范"><span class="toc-number">5.0.2.</span> <span class="toc-text">索引规范</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SQL语句"><span class="toc-number">5.0.3.</span> <span class="toc-text">SQL语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ORM映射"><span class="toc-number">5.0.4.</span> <span class="toc-text">ORM映射</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#工程结构"><span class="toc-number">6.</span> <span class="toc-text">工程结构</span></a></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(/img/cat.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">LIN is keeping learning</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">java 规范</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="Created 2020-04-28 14:43:35"><i class="fa fa-calendar" aria-hidden="true"></i> Created 2020-04-28</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="Updated 2020-05-09 21:24:57"><i class="fa fa-history" aria-hidden="true"></i> Updated 2020-05-09</span></time></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>Post View:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><p>参考阿里巴巴Java规范</p>
<h2 id="编程规约"><a href="#编程规约" class="headerlink" title="编程规约"></a>编程规约</h2><h4 id="OOP规范"><a href="#OOP规范" class="headerlink" title="OOP规范"></a>OOP规范</h4><p>浮点数之间的等值判断，基本数据类型不能用 == 比较，包装数据类型不能用 equals来判断</p>
<p>浮点数采用尾数+阶码的编码方式</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">float</span> a = <span class="number">1.0f</span> - <span class="number">0.9f</span>;</span><br><span class="line"><span class="keyword">float</span> b = <span class="number">0.9f</span> - <span class="number">0.8f</span>;</span><br><span class="line"><span class="keyword">float</span> diff = <span class="number">1e-6f</span>;</span><br><span class="line"><span class="keyword">if</span> (Math.abs(a - b) &lt; diff) &#123;</span><br><span class="line">System.out.println(<span class="string">"true"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 BigDecimal 来定义值，再进行浮点数的运算操作。</span></span><br><span class="line">BigDecimal a = <span class="keyword">new</span> BigDecimal(<span class="string">"1.0"</span>);</span><br><span class="line">BigDecimal b = <span class="keyword">new</span> BigDecimal(<span class="string">"0.9"</span>);</span><br><span class="line">BigDecimal c = <span class="keyword">new</span> BigDecimal(<span class="string">"0.8"</span>);</span><br><span class="line">BigDecimal x = a.subtract(b);</span><br><span class="line">BigDecimal y = b.subtract(c);</span><br><span class="line"><span class="keyword">if</span> (x.equals(y)) &#123;</span><br><span class="line">System.out.println(<span class="string">"true"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>禁止使用构造方法BigDecimal(double) 的方式把duble转换为对象，而是采用字符串类型的参数，或者使用BigDecimal的valueof方法构造对象。</p>
<p><code>BigDecimal recommend1 = new BigDecimal(&quot;0.1&quot;);</code><br><code>BigDecimal recommend2 = BigDecimal.valueOf(0.1);</code></p>
<p>构造方法里禁止添加任何的业务逻辑代码，如果有那么放在init 方法内。</p>
<p>类成员和方法的控制访问从严。</p>
<p>禁止外部直接用new方式生成类成员对象，所有类成员对象的构造方法使用private修饰。</p>
<h4 id="日期时间"><a href="#日期时间" class="headerlink" title="日期时间"></a>日期时间</h4><p>日期格式化时，传入的pattern 是yyyy,而不是YYYY，这个两者的含义不同，yyyy表示当天所在的年，YYYY表示当周所在的年</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;)</span><br></pre></td></tr></table></figure>

<p>M 月份</p>
<p>m 分钟</p>
<p>H 24小时制时间</p>
<p>h 12小时制时间</p>
<ol>
<li><strong>不要把全年定在356天，要通过 LocalDate.now().lengthOfYear()获取年的长度</strong></li>
<li><strong>注意闰年的2月份一共有29天，但其他年份不是29天</strong></li>
<li><strong>月份可以用enum表示，数字0-11枚举</strong></li>
</ol>
<h4 id="集合处理"><a href="#集合处理" class="headerlink" title="集合处理"></a>集合处理</h4><p><strong>Set</strong> 存储的对象要覆盖<strong>equals hashCode</strong>方法</p>
<p>判断集合为空，用<strong>isEmpty</strong>方法</p>
<p><strong>在使用 java.util.stream.Collectors 类的 toMap()方法转为 Map 集合时，一定要使用含有参数类型为BinaryOperator，参数名为 mergeFunction 的方法，否则当出现相同 key值时会抛出 IllegalStateException 异常</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Pair&lt;String, Double&gt;&gt; pairArrayList = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">pairArrayList.add(<span class="keyword">new</span> Pair&lt;&gt;(<span class="string">"version"</span>, <span class="number">6.19</span>));</span><br><span class="line">pairArrayList.add(<span class="keyword">new</span> Pair&lt;&gt;(<span class="string">"version"</span>, <span class="number">10.24</span>));</span><br><span class="line">pairArrayList.add(<span class="keyword">new</span> Pair&lt;&gt;(<span class="string">"version"</span>, <span class="number">13.14</span>));</span><br><span class="line">Map&lt;String, Double&gt; map = pairArrayList.stream().collect(</span><br><span class="line"><span class="comment">// 生成的 map 集合中只有一个键值对：&#123;version=13.14&#125;</span></span><br><span class="line">Collectors.toMap(Pair::getKey, Pair::getValue, (v1, v2) -&gt; v2));</span><br></pre></td></tr></table></figure>

<p><strong>这是如果value为空，就会抛出NPE异常</strong></p>
<p>Collections 类返回的对象，如： emptyList() / singletonList() 等都是 immutable不可变的集合 list，不可对其进行添加或者删除元素的操作。</p>
<p>集合转换成数组时，用集合的toArray(T[] array)方法，传入的数组类型为 集合元素相同的类型，长度为0的空数组。</p>
<p>list.add(“string” )   list.toArray(new String[0])  集合元素是字符串类型，所有传入的也是字符串类型的空数组。</p>
<p>实现Collection接口的addAll 方法时，要对传入的参数进行空判断，否则抛出异常</p>
<p><strong>泛型通配符 &lt;? extends T&gt; 来接收返回的数据，此写法的泛型集合不能使用 add 方法，而 &lt;? super T&gt; 不能使用 get 方法，两者在接口调用赋值的场景中容易出错。</strong></p>
<p>不要再foreach进行remove，add元素，要在迭代器进行移除，或者添加元素。</p>
<p>集合初始化时，指定合适的大小。默认大小为16</p>
<p>map遍历要用entrySet</p>
<p><strong>高度注意map中K/V能不能为空</strong>  不同的map，有不同的要求</p>
<p>利用集合的Set的特性去重</p>
<p>合理利用集合的有序性sort和稳定性order</p>
<h4 id="并发"><a href="#并发" class="headerlink" title="并发"></a>并发</h4><p>线程资源必须通过线程池提供，不要显示地创建线程</p>
<p>ThreadPoolExecutor接口创建线程池，而不要用Excutors</p>
<p>SimpleDateFormat为不安全的线程类，如果要使用要加上锁机制，或者使用工具类，使用<strong>ThreadLocal</strong>为每一线程创建一个实例</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;DateFormat&gt; df = <span class="keyword">new</span> ThreadLocal&lt;DateFormat&gt;() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> DateFormat <span class="title">initialValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<p>要回收ThreadLocal创建的变量，减少资源使用在try finally中回收</p>
<p><strong>在使用尝试获取锁机制中tryLock，进行业务逻辑时判断该线程是否持有锁，如果没有就不执行业务，而是执行其他代码。tryLock返回的是布尔类型 ，获取锁为真。</strong></p>
<p><strong>并发修改同一记录时，要么在业务层上锁，要么在cache加锁，要么就是在数据库底层加锁，数据库底层可以使用乐观锁</strong></p>
<p>使用 CountDownLatch 进行异步转同步操作，每个线程退出前必须调用 countDown 方法，线程执行代码注意 catch 异常，确保 countDown 方法被执行到，避免主线程无法执行至await 方法，直到超时才返回结果</p>
<p>volatile 解决多线程内存不可见问题。对于一写多读，是可以解决变量同步问题，但是如果多写，同样无法解决线程安全问题。</p>
<p>控制语句</p>
<p>switch 括号内的变量为string类型时，需要进行null判断</p>
<p>避免使用反逻辑运算符 ！</p>
<p>方法入参保护，业务逻辑代码中查询多少个会员数，如100000，个数太多，查询信息过多，内存占暴</p>
<p>不要在判断里面进行赋值运算</p>
<p>三目运算符 注意类型对齐时，发生的自动拆箱导致的NPE异常</p>
<p><strong>在使用正则表达式时，利用好其预编译功能，可以有效加快正则匹配速度。</strong><br><strong>说明：不要在方法体内定义：Pattern pattern = Pattern.compile(“规则”);</strong></p>
<p><strong>后台输送给页面的变量必须加 $!{var} ——中间的感叹号。</strong><br><strong>说明：如果 var 等于 null 或者不存在，那么${var}会直接显示在页面上。</strong></p>
<p>任何数据结构的构造或初始化，都应指定大小，避免数据结构无限增长吃光内存。</p>
<h2 id="异常日志"><a href="#异常日志" class="headerlink" title="异常日志"></a>异常日志</h2><p>错误码的指定原则，快速溯源，简单易记</p>
<p>全部正常时，但不得不填充错误码，填充00000</p>
<p>错误码为字符类型 共5为，分成两部分，错误来源+数字编号 ，如A0121密码长度不够</p>
<p>错误码分为一级宏观错误码 用户端，二级宏观错误码  系统，三级宏观错误码  第三方错误</p>
<h4 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h4><p>Java类库中定义的可以通过<strong>预检查</strong>方式规避 RuntimeException ，因为catch不能捕获运行异常。</p>
<p>预检查方式 if (object ! = null) { ….  }</p>
<p>catcher时要分清楚稳定代码 和  非稳定代码 ，稳定代码及无论如何都不会出错的代码。</p>
<p><strong>事务场景中，抛出异常被 catch 后，如果需要回滚，一定要注意手动回滚事务。</strong></p>
<p>不要在 finally 块中使用 return。</p>
<p><strong>在调用 RPC、二方包、或动态生成类的相关方法时，捕捉异常必须使用 Throwable</strong><br><strong>类来进行拦截。</strong></p>
<p><strong>防止 NPE ，是程序员的基本修养，注意 NPE 产生的场景：</strong></p>
<p>1） 返回类型为基本数据类型，return 包装数据类型的对象时，自动拆箱有可能产生 NPE。<br>反例：public int f() { return Integer 对象}， 如果为 null，自动解箱抛 NPE。<br>2） 数据库的查询结果可能为 null。<br>3） 集合里的元素即使 isNotEmpty，取出的数据元素也可能为 null。<br>4） 远程调用返回对象时，一律要求进行空指针判断，防止 NPE。<br>5） 对于 Session 中获取的数据，建议进行 NPE 检查，避免空指针。<br>6） 级联调用 obj.getA().getB().getC()；一连串调用，易产生 NPE。<br>正例：使用 JDK8 的 Optional 类来防止 NPE 问题。</p>
<p>对于公司外的 http/api 开放接口必须使用“错误码”；而应用内部推荐异常抛出；<br>跨应用间 RPC 调用优先考虑使用 Result 方式，封装 isSuccess()方法、“错误码”、“错误<br>简短信息”；而应用内部推荐异常抛出。</p>
<h4 id="日志规约"><a href="#日志规约" class="headerlink" title="日志规约"></a>日志规约</h4><p>使用门面模式的日志框架 推荐使用SLF4J</p>
<p>所有日志文件至少保存 15 天，因为有些异常具备以“周”为频次发生的特点。对于<br>当天日志，以“应用名.log”来保存，保存在/home/admin/应用名/logs/</font>目录下，<br>过往日志格式为: {logname}.log.{保存日期}，日期格式：yyyy-MM-dd</p>
<p>对于 trace / debug / info 级别的日志输出，必须进行日志级别的开关判断。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; 如果判断为真，那么可以输出 trace 和 debug 级别的日志</span><br><span class="line">if (logger.isDebugEnabled()) &#123;</span><br><span class="line">logger.debug(&quot;Current ID is: &#123;&#125; and name is: &#123;&#125;&quot;, id, getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>避免重复打印日志，浪费磁盘空间，务必在 log 4 j . xml 中设置 additivity = false 。</p>
<p>异常信息应该包括两类信息：案发现场信息和异常堆栈信息。如果不处理，那么通过<br>关键字 throws 往上抛出。<br>正例：logger.error(各类参数或者对象 toString() + “_” + e.getMessage(), e);</p>
<p>谨慎地记录日志。生产环境禁止输出 debug 日志 ； 有选择地输出 info 日志 ； 如果使用<br>warn 来记录刚上线时的业务行为信息，一定要注意日志输出量的问题，避免把服务器磁盘撑<br>爆，并记得及时删除这些观察日志。</p>
<h2 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h2><p>好的单元测试必须遵守 AIR 原则。</p>
<ol>
<li>A：Automatic（自动化）</li>
<li>I：Independent（独立性）</li>
<li>R：Repeatable（可重复）</li>
</ol>
<p>单元测试应该是全自动执行的，并且非交互式的。测试用例通常是被定期执行的，执<br>行过程必须完全自动化才有意义。输出结果需要人工检查的测试不是一个好的单元测试。单元<br>测试中不准使用 System.out 来进行人肉验证<strong>，必须使用 assert 来验证</strong>。</p>
<p><strong>保持单元测试的独立性。为了保证单元测试稳定可靠且便于维护，单元测试用例之间</strong><br><strong>决不能互相调用，也不能依赖执行的先后次序。</strong></p>
<p>对于单元测试，要保证测试粒度足够小，有助于精确定位问题。单测粒度至多是类级<br>别，<strong>一般是方法级别。</strong></p>
<p>单元测试的基本目标：语句覆盖率达到 70% ；核心模块的语句覆盖率和分支覆盖率都<br>要达到 100%。 DAO 层，Manager 层，可重用度高的 Service，都应该进行单元测<br>试。</p>
<p>编写单元测试代码遵守 BCDE 原则，以保证被测试模块的交付质量</p>
<p>B：Border，边界值测试，包括循环边界、特殊取值、特殊时间点、数据顺序等。</p>
<p> C：Correct，正确的输入，并得到预期的结果。</p>
<p> D：Design，与设计文档相结合，来编写单元测试。</p>
<p> E：Error，强制错误信息输入（如：非法数据、异常流程、业务允许外等），并得到预期的结果。</p>
<p>对于数据库相关的查询，更新，删除等操作，不能假设数据库里的数据是存在的，或<br>者直接操作数据库把数据插入进去，请使用程序插入或者导入数据的方式来准备数据</p>
<p>和数据库相关的单元测试，可以设定自动回滚机制，不给数据库造成脏数据。或者对<br>单元测试产生的数据有明确的前后缀标识。</p>
<h2 id="安全规约"><a href="#安全规约" class="headerlink" title="安全规约"></a>安全规约</h2><p>用户请求传入的任何参数必须做有效性验证。</p>
<p>表单、 AJAX 提交必须执行 CSRF 安全验证</p>
<p>URL 外部重定向传入的目标地址必须执行白名单过滤</p>
<p>在使用平台资源，譬如短信、邮件、电话、下单、支付，必须实现正确的防重放的机<br>制，如数量限制、疲劳度控制、验证码校验，避免被滥刷而导致资损。</p>
<h2 id="MYSQL规约"><a href="#MYSQL规约" class="headerlink" title="MYSQL规约"></a>MYSQL规约</h2><h4 id="建表规约"><a href="#建表规约" class="headerlink" title="建表规约"></a>建表规约</h4><p>表达是与否概念的字段，必须使用 is_xxx 的方式命名，数据类型是 unsigned tinyint<br>（1 表示是，0 表示否）。<br>说明：任何字段如果为非负数，必须是 unsigned。<br>注意：POJO 类中的任何布尔类型的变量，都不要加 is 前缀，所以，需要在<resultMap>设置从 is_xxx 到<br>Xxx 的映射关系。数据库表示是与否的值，使用 tinyint 类型，坚持 is_xxx 的命名方式是为了明确其取值含<br>义与取值范围。<br>正例：表达逻辑删除的字段名 is_deleted，1 表示删除，0 表示未删除。</p>
<p>表名不使用复数名词。</p>
<p>主键索引名为 pk_ 字段名；唯一索引名为 uk _字段名 ； 普通索引名则为 idx _字段名</p>
<p>小数类型为 decimal，禁止使用 float 和 double。在存储的时候，float 和 double 都存在精度损失的问题，很可能在比较值的时候，得到不正确的结果。如果存储的数据范围超过 decimal 的范围，建议将数据拆成整数和小数并分开存储</p>
<p>如果存储的字符串长度几乎相等，使用 char 定长字符串类型</p>
<p> varchar 是可变长字符串，不预先分配存储空间，长度不要超过 5000，如果存储长度<br>大于此值，定义字段类型为 text ，独立出来一张表，用主键来对应，避免影响其它字段索引效<br>率。</p>
<p><strong>表必备三字段：id, gmt_create, gmt_modified。</strong><br>说明：其中 id 必为主键，类型为 bigint unsigned、单表时自增、步长为 1。gmt_create, gmt_modified<br>的类型均为 datetime 类型，前者现在时表示主动式创建，后者过去分词表示被动式更新。</p>
<h4 id="索引规范"><a href="#索引规范" class="headerlink" title="索引规范"></a>索引规范</h4><p>业务上具有唯一特性的字段，即使是组合字段，也必须建成唯一索引</p>
<h4 id="SQL语句"><a href="#SQL语句" class="headerlink" title="SQL语句"></a>SQL语句</h4><p>使用 ISNULL() 来判断是否为 NULL 值。</p>
<p>NULL 与任何值的直接比较都为 NULL</p>
<p>代码中写分页查询逻辑时，若 count 为 0 应直接返回，避免执行后面的分页语句</p>
<p>不得使用外键与级联，一切外键概念必须在应用层解决</p>
<p>学生表中的 student_id 是主键，那么成绩表中的 student_id 则为外键。如果更新学<br>生表中的 student_id，同时触发成绩表中的 student_id 更新，即为级联更新。外键与级联更新适用于单机<br>低并发，不适合分布式、高并发集群；级联更新是强阻塞，存在数据库更新风暴的风险；外键影响数据库<br>的插入速度。</p>
<p>禁止使用存储过程，存储过程难以调试和扩展，更没有移植性</p>
<p>数据订正（特别是删除或修改记录操作）时，要先 select ，避免出现误删除，确认无<br>误才能执行更新语句</p>
<p>对于数据库中表记录的查询和变更，只要涉及多个表，都需要在列名前加表的别名（或<br>表名）进行限定</p>
<p> in 操作能避免则避免，若实在避免不了，需要仔细评估 in 后边的集合元素数量，控<br>制在 1000 个之内。</p>
<h4 id="ORM映射"><a href="#ORM映射" class="headerlink" title="ORM映射"></a>ORM映射</h4><p>在表查询中，一律不要使用 * 作为查询的字段列表，需要哪些字段必须明确写明。</p>
<p>POJO 类的布尔属性不能加 is，而数据库字段必须加 is_，要求在 resultMap 中进行<br>字段与属性之间的映射</p>
<p>不要用 resultClass 当返回参数，即使所有类属性名与数据库字段一一对应，也需要<br>定义<resultMap>；反过来，每一个表也必然有一个<resultMap>与之对应</p>
<p>sql. xml 配置参数使用：#{}，# param # 不要使用${} 此种方式容易出现 SQL 注入</p>
<p>不允许直接拿 HashMap 与 Hashtable 作为查询结果集的输出。</p>
<p>更新数据表记录时，必须同时更新记录对应的 gmt_modified 字段值为当前时间。</p>
<h2 id="工程结构"><a href="#工程结构" class="headerlink" title="工程结构"></a>工程结构</h2><p>• DO（Data Object）：此对象与数据库表结构一一对应，通过 DAO 层向上传输数据源对象。<br>• DTO（Data Transfer Object）：数据传输对象，Service 或 Manager 向外传输的对象。<br>• BO（Business Object）：业务对象，可以由 Service 层输出的封装业务逻辑的对象。<br>• Query：数据查询对象，各层接收上层的查询请求。注意超过 2 个参数的查询封装，禁止使用 Map 类<br>来传输。<br>• VO（View Object）：显示层对象，通常是 Web 向模板渲染引擎层传输的对象。</p>
<p>服务器</p>
<p>高并发服务器建议调小 TCP 协议的 time _ wait 超时时间</p>
<p>CAS 操作包含三个操作数：内存位置、预期原值和新值</p>
<p>NPE（ java.lang.NullPointerException ）: 空指针异常。</p>
<p>一方库: 本工程内部子项目模块依赖的库（jar 包）。</p>
<p>二方库: 公司内部发布到中央仓库，可供公司内部其它应用依赖的库（jar 包）。</p>
<p>三方库: 公司之外的开源库（jar 包）。</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Lin</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/04/28/java-%E8%A7%84%E8%8C%83/">http://yoursite.com/2020/04/28/java-%E8%A7%84%E8%8C%83/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java/">java</a></div><div class="post_share"><div class="social-share" data-image="/img/cat.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/04/28/java-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%BA%8C/"><img class="prev_cover lazyload" data-src="/img/cat.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">java 学习笔记二</div></div></a></div><div class="next-post pull_right"><a href="/2020/04/25/%E7%AE%97%E6%B3%95-java%E5%AE%9E%E7%8E%B0/"><img class="next_cover lazyload" data-src="/img/cat.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">算法 java,go实现</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> Recommend</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/04/21/java并发/" title="java并发"><img class="relatedPosts_cover lazyload"data-src="/img/cat.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-21</div><div class="relatedPosts_title">java并发</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/21/java图形编程/" title="java图像编程"><img class="relatedPosts_cover lazyload"data-src="/img/cat.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-21</div><div class="relatedPosts_title">java图像编程</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/25/算法-java实现/" title="算法 java,go实现"><img class="relatedPosts_cover lazyload"data-src="/img/cat.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-25</div><div class="relatedPosts_title">算法 java,go实现</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/28/java-学习笔记二/" title="java 学习笔记二"><img class="relatedPosts_cover lazyload"data-src="/img/cat.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-28</div><div class="relatedPosts_title">java 学习笔记二</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> Comment</span></div><script id="utterances_comment" src="https://utteranc.es/client.js" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script><script>var themeNow = document.documentElement.getAttribute('data-theme') === 'dark' ? 'photon-dark' : 'github-light'
document.getElementById('utterances_comment').setAttribute('theme',themeNow)

function utterancesTheme () {
var theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'photon-dark' : 'github-light'
const message = {
  type: 'set-theme',
  theme: theme
};
const iframe = document.querySelector('.utterances-frame');
iframe.contentWindow.postMessage(message, 'https://utteranc.es');
}</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Lin</div><div class="framework-info"><span>Driven </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="Read Mode"></i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="Traditional Chinese and Simplified Chinese Conversion" target="_self">简</a><i class="darkmode fa fa-moon-o" id="darkmode" title="Dark Mode"></i></div><div id="rightside-config-show"><div id="rightside_config" title="Setting"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="Scroll to comment"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="Table of Contents" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="Back to top" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/js/third-party/ClickShowText.js"></script></body></html>